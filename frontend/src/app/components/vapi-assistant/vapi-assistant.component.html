<div class="vapi-assistant" @fadeSlideIn>
  <!-- Header -->
  <div class="assistant-header">
    <div class="header-left">
      <div class="assistant-avatar" [class.active]="isCallActive" [class.speaking]="isSpeaking">
        <mat-icon>support_agent</mat-icon>
        <div class="pulse-ring" *ngIf="isSpeaking"></div>
      </div>
      <div class="header-info">
        <h2>Medical Booking Assistant</h2>
        <span class="status-text" [class.active]="isCallActive">{{ statusText }}</span>
      </div>
    </div>
    <button class="close-btn" (click)="onClose()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Main Content -->
  <div class="assistant-content">
    <!-- Left: Chat Interface -->
    <div class="chat-panel">
      <div class="messages-container" #messagesContainer>
        <div
          *ngFor="let message of messages"
          class="message"
          [ngClass]="'message-' + message.role"
          @messageAnimation
        >
          <div class="message-avatar" *ngIf="message.role === 'assistant'">
            <mat-icon>smart_toy</mat-icon>
          </div>
          <div class="message-bubble">
            <p>{{ message.content }}</p>
            <span class="message-time">{{ message.timestamp | date:'shortTime' }}</span>
          </div>
          <div class="message-avatar user" *ngIf="message.role === 'user'">
            <mat-icon>person</mat-icon>
          </div>
        </div>

        <!-- Typing Indicator -->
        <div class="message message-assistant" *ngIf="isSpeaking">
          <div class="message-avatar">
            <mat-icon>smart_toy</mat-icon>
          </div>
          <div class="message-bubble typing">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Call Controls -->
      <div class="call-controls">
        <div class="voice-indicator" [class.active]="isListening">
          <div class="voice-wave" *ngIf="isListening">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span class="indicator-text" *ngIf="!isListening && !isSpeaking && isCallActive">
            Say something...
          </span>
        </div>

        <button
          class="call-btn"
          [class.active]="isCallActive"
          [class.connecting]="isConnecting"
          [disabled]="isConnecting"
          (click)="toggleCall()"
        >
          <mat-icon *ngIf="!isCallActive && !isConnecting">mic</mat-icon>
          <mat-icon *ngIf="isCallActive">call_end</mat-icon>
          <mat-icon *ngIf="isConnecting">sync</mat-icon>
          <span>{{ callButtonText }}</span>
        </button>
      </div>
    </div>

    <!-- Right: Booking Form -->
    <div class="form-panel">
      <div class="form-header">
        <h3>Booking Information</h3>
      </div>

      <div class="form-content">
        <div class="booking-fields-list">
          <input
            *ngFor="let field of formFields"
            [formControl]="getFormControl(field.key)"
            class="booking-field-input"
            [placeholder]="field.label"
            readonly
          />
        </div>
      </div>
    </div>
  </div>
</div>
