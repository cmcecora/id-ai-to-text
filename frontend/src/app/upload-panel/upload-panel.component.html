<div class="upload-panel">
  <!-- Readonly text field to display selected filename -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Choose ID Photo</mat-label>
    <input
      matInput
      type="text"
      [value]="selectedFile?.name || ''"
      placeholder="Select a file to upload"
      readonly
    />
    <!-- Button suffix triggers hidden file input -->
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="fileInput.click()"
      [disabled]="isUploading || disabled"
      aria-label="Select file"
    >
      <mat-icon>cloud_upload</mat-icon>
    </button>
    <mat-hint>
      Accepted formats: {{ acceptedTypes.join(', ').toUpperCase() }} â€¢ Max size: 10MB
    </mat-hint>
  </mat-form-field>

  <!-- Hidden native file input (matInput does not support type=file) -->
  <input
    #fileInput
    id="file-input"
    type="file"
    [accept]="acceptedTypes.join(',')"
    (change)="onFileSelected($event)"
    hidden
  />

  <!-- File Preview -->
  <div *ngIf="selectedFile" class="file-preview">
    <div class="preview-container">
      <img
        *ngIf="previewUrl && selectedFile?.type !== 'application/pdf'"
        [src]="previewUrl"
        alt="ID photo preview"
        class="preview-image"
      />

      <div *ngIf="selectedFile?.type === 'application/pdf'" class="pdf-preview">
        <mat-icon>picture_as_pdf</mat-icon>
        <p>PDF Document</p>
      </div>
    </div>

    <!-- File Info -->
    <div class="file-info">
      <p><strong>{{ selectedFile.name }}</strong></p>
      <p>{{ formatFileSize(selectedFile.size) }}</p>

      <div *ngIf="fileSizeExceeded" class="error-message">
        <mat-icon color="warn">warning</mat-icon>
        <span>File size exceeds 10MB limit</span>
      </div>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="uploadSuccess && !isUploading" class="success-message">
    <mat-icon color="primary">check_circle</mat-icon>
    <span>ID photo uploaded and processed successfully!</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="isUploading" class="loading-container">
    <mat-progress-spinner
      mode="indeterminate"
      diameter="40"
    ></mat-progress-spinner>
    <p>Extracting text from ID photo...</p>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button
      mat-raised-button
      color="primary"
      (click)="uploadFile()"
      [disabled]="!selectedFile || isUploading || fileSizeExceeded"
      class="upload-btn"
    >
      <mat-icon>upload</mat-icon>
      Extract Text
    </button>

    <button
      mat-button
      (click)="clearFile()"
      [disabled]="isUploading"
      class="clear-btn"
    >
      <mat-icon>clear</mat-icon>
      Choose Different File
    </button>
  </div>

  <!-- Upload Instructions -->
  <div class="instructions">
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title>Instructions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ul>
          <li>Select an identity document (ID card, driver's license, passport)</li>
          <li>Accepted formats: JPG, PNG, PDF, HEIC</li>
          <li>Maximum file size: 10MB</li>
          <li>HEIC files will be converted to JPEG by the server</li>
          <li>Ensure the document is clear and all text is readable</li>
        </ul>
      </mat-card-content>
    </mat-card>
  </div>
</div>
