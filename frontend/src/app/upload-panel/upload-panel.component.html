<div class="upload-panel">
  <!-- Drop Zone -->
  <div
    class="dropzone"
    [class.dragover]="isDragOver"
    [class.has-file]="selectedFile"
    (click)="fileInput.click()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <div class="dropzone-icon">
      <mat-icon>add_photo_alternate</mat-icon>
    </div>
    <p class="dropzone-title">Drag & drop your ID photo here</p>
    <p class="dropzone-subtitle">or click to browse files</p>
    <button
      type="button"
      class="btn btn-primary choose-file-btn"
      (click)="$event.stopPropagation(); fileInput.click()"
      [disabled]="isUploading || disabled"
    >
      Choose File
    </button>
  </div>

  <!-- Hidden native file input -->
  <input
    #fileInput
    id="file-input"
    type="file"
    [accept]="acceptedTypes.join(',')"
    (change)="onFileSelected($event)"
    hidden
  />

  <!-- File Format Info -->
  <div class="file-format-info">
    <mat-icon>info_outline</mat-icon>
    <span>Accepted formats: {{ acceptedTypes.join(', ').toUpperCase() }} &bull; Max size: 10MB</span>
  </div>

  <!-- File Preview -->
  <div *ngIf="selectedFile" class="file-preview">
    <div class="preview-wrapper">
      <div class="preview-image-container">
        <img
          *ngIf="previewUrl && selectedFile?.type !== 'application/pdf'"
          [src]="previewUrl"
          alt="ID photo preview"
          class="preview-image"
        />

        <div *ngIf="selectedFile?.type === 'application/pdf'" class="pdf-preview">
          <mat-icon>picture_as_pdf</mat-icon>
        </div>
      </div>

      <div class="preview-info">
        <p class="file-name">{{ selectedFile.name }}</p>
        <p class="file-size">{{ formatFileSize(selectedFile.size) }}</p>

        <div *ngIf="!fileSizeExceeded" class="status-badge success">
          <mat-icon>check_circle</mat-icon>
          <span>Ready to process</span>
        </div>

        <div *ngIf="fileSizeExceeded" class="status-badge error">
          <mat-icon>error</mat-icon>
          <span>File size exceeds 10MB limit</span>
        </div>
      </div>

      <button
        type="button"
        class="remove-file-btn"
        (click)="clearFile()"
        [disabled]="isUploading"
        aria-label="Remove file"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="uploadSuccess && !isUploading" class="status-message success">
    <mat-icon>check_circle</mat-icon>
    <span>ID photo uploaded and processed successfully!</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="isUploading" class="loading-container">
    <div class="loading-spinner">
      <mat-progress-spinner
        mode="indeterminate"
        diameter="40"
        strokeWidth="3"
      ></mat-progress-spinner>
    </div>
    <p>Extracting text from ID photo...</p>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button
      type="button"
      class="btn btn-primary upload-btn"
      (click)="uploadFile()"
      [disabled]="!selectedFile || isUploading || fileSizeExceeded || disabled"
    >
      <mat-icon>document_scanner</mat-icon>
      Extract Text
    </button>

    <button
      type="button"
      class="btn btn-outline clear-btn"
      (click)="clearFile()"
      [disabled]="isUploading || !selectedFile"
    >
      <mat-icon>refresh</mat-icon>
      Clear
    </button>
  </div>

  <!-- Divider -->
  <div class="section-divider"></div>

  <!-- Instructions Card -->
  <div class="tips-card">
    <div class="tips-header">
      <mat-icon>lightbulb</mat-icon>
      <h3>Tips for best results</h3>
    </div>
    <ul class="tips-list">
      <li>
        <mat-icon>check</mat-icon>
        <span>Ensure the document is well-lit and in focus</span>
      </li>
      <li>
        <mat-icon>check</mat-icon>
        <span>All text should be clearly readable</span>
      </li>
      <li>
        <mat-icon>check</mat-icon>
        <span>Avoid glare and shadows on the document</span>
      </li>
      <li>
        <mat-icon>check</mat-icon>
        <span>Include all four corners of the ID</span>
      </li>
    </ul>
  </div>
</div>
