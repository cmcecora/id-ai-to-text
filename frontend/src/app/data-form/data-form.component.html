<div class="data-form">
  <!-- Form Status - Waiting State -->
  <div class="form-status" *ngIf="isProcessing || !ocrData">
    <div *ngIf="isProcessing" class="status-processing">
      <div class="loading-spinner">
        <mat-progress-spinner
          mode="indeterminate"
          diameter="40"
          strokeWidth="3"
        ></mat-progress-spinner>
      </div>
      <p class="status-title">Extracting information...</p>
      <p class="status-subtitle">This may take a few seconds</p>
    </div>

    <div *ngIf="!ocrData && !isProcessing" class="status-waiting">
      <div class="waiting-icon">
        <mat-icon>cloud_upload</mat-icon>
      </div>
      <p class="status-title">Waiting for ID photo</p>
      <p class="status-subtitle">Upload a document to see extracted data here</p>
    </div>
  </div>

  <!-- Main Form -->
  <form [formGroup]="documentForm" *ngIf="ocrData && !isProcessing" class="form-content">
    <!-- Personal Information Section -->
    <div class="form-section">
      <h3 class="section-title">Personal Information</h3>

      <div class="form-grid">
        <div class="form-field">
          <label class="field-label">First Name</label>
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="firstName"
              [readonly]="isFormLocked"
              class="wh-input"
              [class.readonly]="isFormLocked"
            />
            <mat-icon class="field-icon">person</mat-icon>
          </div>
          <span *ngIf="isFieldInvalid('firstName')" class="field-error">
            {{ getErrorMessage('firstName') }}
          </span>
        </div>

        <div class="form-field">
          <label class="field-label">Last Name</label>
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="lastName"
              [readonly]="isFormLocked"
              class="wh-input"
              [class.readonly]="isFormLocked"
            />
            <mat-icon class="field-icon">person</mat-icon>
          </div>
          <span *ngIf="isFieldInvalid('lastName')" class="field-error">
            {{ getErrorMessage('lastName') }}
          </span>
        </div>
      </div>

      <div class="form-grid three-col">
        <div class="form-field">
          <label class="field-label">Middle Initial</label>
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="middleInitial"
              maxlength="1"
              [readonly]="isFormLocked"
              class="wh-input text-center"
              [class.readonly]="isFormLocked"
            />
          </div>
          <span *ngIf="isFieldInvalid('middleInitial')" class="field-error">
            {{ getErrorMessage('middleInitial') }}
          </span>
        </div>

        <div class="form-field">
          <label class="field-label">Sex</label>
          <div class="select-wrapper">
            <select
              formControlName="sex"
              [disabled]="isFormLocked"
              class="wh-select"
              [class.readonly]="isFormLocked"
            >
              <option value="">Select</option>
              <option *ngFor="let option of sexOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <mat-icon class="select-arrow">expand_more</mat-icon>
          </div>
          <span *ngIf="isFieldInvalid('sex')" class="field-error">
            {{ getErrorMessage('sex') }}
          </span>
        </div>

        <div class="form-field">
          <label class="field-label">Date of Birth</label>
          <div class="input-wrapper">
            <input
              type="text"
              [matDatepicker]="dobPicker"
              formControlName="dob"
              [readonly]="isFormLocked"
              class="wh-input"
              [class.readonly]="isFormLocked"
            />
            <mat-datepicker-toggle matSuffix [for]="dobPicker" class="date-toggle"></mat-datepicker-toggle>
            <mat-datepicker #dobPicker></mat-datepicker>
          </div>
          <span *ngIf="isFieldInvalid('dob')" class="field-error">
            {{ getErrorMessage('dob') }}
          </span>
        </div>
      </div>
    </div>

    <!-- Section Divider -->
    <div class="section-divider"></div>

    <!-- Address Information Section -->
    <div class="form-section">
      <h3 class="section-title">Address Information</h3>

      <div class="form-field full-width">
        <label class="field-label">Street Address</label>
        <div class="input-wrapper">
          <input
            type="text"
            formControlName="addressStreet"
            [readonly]="isFormLocked"
            class="wh-input"
            [class.readonly]="isFormLocked"
          />
          <mat-icon class="field-icon">home</mat-icon>
        </div>
        <span *ngIf="isFieldInvalid('addressStreet')" class="field-error">
          {{ getErrorMessage('addressStreet') }}
        </span>
      </div>

      <div class="form-grid address-grid">
        <div class="form-field city-field">
          <label class="field-label">City</label>
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="addressCity"
              [readonly]="isFormLocked"
              class="wh-input"
              [class.readonly]="isFormLocked"
            />
          </div>
          <span *ngIf="isFieldInvalid('addressCity')" class="field-error">
            {{ getErrorMessage('addressCity') }}
          </span>
        </div>

        <div class="form-field state-field">
          <label class="field-label">State</label>
          <div class="select-wrapper">
            <select
              formControlName="addressState"
              [disabled]="isFormLocked"
              class="wh-select"
              [class.readonly]="isFormLocked"
            >
              <option value="">Select</option>
              <option *ngFor="let state of stateOptions" [value]="state">
                {{ state }}
              </option>
            </select>
            <mat-icon class="select-arrow">expand_more</mat-icon>
          </div>
          <span *ngIf="isFieldInvalid('addressState')" class="field-error">
            {{ getErrorMessage('addressState') }}
          </span>
        </div>

        <div class="form-field zip-field">
          <label class="field-label">ZIP Code</label>
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="addressZip"
              [readonly]="isFormLocked"
              class="wh-input"
              [class.readonly]="isFormLocked"
            />
          </div>
          <span *ngIf="isFieldInvalid('addressZip')" class="field-error">
            {{ getErrorMessage('addressZip') }}
          </span>
        </div>
      </div>
    </div>

    <!-- Validation Status -->
    <div class="validation-status" *ngIf="!isFormLocked && documentForm.dirty">
      <div *ngIf="documentForm.valid" class="status-badge success">
        <mat-icon>check_circle</mat-icon>
        <span>All fields are valid</span>
      </div>

      <div *ngIf="documentForm.invalid" class="status-badge error">
        <mat-icon>error</mat-icon>
        <span>Please fix validation errors</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button
        type="button"
        class="btn btn-primary save-btn"
        (click)="onSave()"
        [disabled]="documentForm.invalid || isFormLocked || isSaving"
        *ngIf="!isFormLocked"
      >
        <mat-icon *ngIf="!isSaving">save</mat-icon>
        <mat-progress-spinner
          *ngIf="isSaving"
          mode="indeterminate"
          diameter="18"
          strokeWidth="2"
        ></mat-progress-spinner>
        {{ isSaving ? 'Saving...' : 'Save Information' }}
      </button>

      <button
        type="button"
        class="btn btn-black edit-btn"
        (click)="onEdit()"
        [disabled]="!isFormLocked || isSaving"
        *ngIf="isFormLocked"
      >
        <mat-icon>edit</mat-icon>
        Edit
      </button>

      <button
        type="button"
        class="btn btn-outline-subtle clear-btn"
        (click)="onClear()"
        [disabled]="isSaving"
      >
        <mat-icon>close</mat-icon>
        Clear
      </button>
    </div>
  </form>
</div>
